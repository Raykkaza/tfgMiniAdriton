<div class="container">
    <!-- Columna izquierda: Calendario -->
    <div class="calendar">
        <div class="cal-nav">
            <button (click)="mesAnterior()" [disabled]="!puedeRetroceder()">â€¹</button>
            <span>{{ viewDate | date:'MMMM yyyy':'':'es' }}</span>
            <button (click)="mesSiguiente()" [disabled]="!puedeAvanzar()">â€º</button>
        </div>

        <mwl-calendar-month-view #monthView [viewDate]="viewDate" [weekStartsOn]="1" [events]="events"
            (dayClicked)="onDayClicked($event.day.date)" (beforeViewRender)="beforeMonthViewRender($event)">
        </mwl-calendar-month-view>
    </div>

    <!-- Columna derecha: Lista de citas -->
    <div class="event-list">
        <div class="legend" *ngIf="!isAdmin">
            <span class="dot dot-mine" aria-hidden="true"></span>
            <span class="legend-text">Tus citas</span>
        
            <span class="dot dot-other" aria-hidden="true"></span>
            <span class="legend-text">Citas ocupadas</span>
        </div>
        <h3 *ngIf="selectedDate">Citas para {{ selectedDate | date: 'fullDate' }}</h3>

        <ul *ngIf="selectedDate">
            <li *ngFor="let event of getEventsForDay(selectedDate)">
                ğŸ•’ {{ event.start | date:'HH:mm' }} - {{ event.end | date:'HH:mm' }}: {{ event.title }}
        
                <div *ngIf="!isAdmin && event.meta?.status === 0" class="pendiente-cita">
                    Pendiente de aprobaciÃ³n
                </div>
            </li>
        
            <li *ngIf="getEventsForDay(selectedDate).length === 0">
                No tienes citas programadas para este dÃ­a.
            </li>
        </ul>

        <p *ngIf="!selectedDate">Haz clic en un dÃ­a para ver las citas</p>

        <!-- Mensaje de restricciÃ³n -->
        <div *ngIf="!isAdmin && tieneCitaPendiente" class="alerta-cita-pendiente">
            Ya tienes una cita pendiente de aprobaciÃ³n. Espera a que se apruebe antes de solicitar otra.
        </div>
        
        <!-- BotÃ³n dinÃ¡mico -->
        <button (click)="alternarFormulario()" [disabled]="!selectedDate || (!isAdmin && tieneCitaPendiente)">
            {{ mostrarFormulario ? 'Cancelar' : (isAdmin ? 'AÃ±adir consulta' : 'Pedir cita') }}
        </button>

        <!-- Formulario expandible -->
        <div class="formulario-cita" *ngIf="mostrarFormulario">
            <h4>
                {{ isAdmin ? 'Nueva consulta' : 'Solicitud de cita' }} para {{ selectedDate | date:'fullDate' }}
            </h4>

            <label>
                Nombre:
                <input [(ngModel)]="nuevoNombre" type="text" />
            </label>

            <label>
                Hora:
                <select [(ngModel)]="nuevaHora">
                    <option *ngFor="let hora of horasDisponibles" [value]="hora">
                        {{ hora }}
                    </option>
                </select>
            </label>

            <div class="form-actions">
                <button (click)="crearConsulta()">
                    {{ isAdmin ? 'Guardar consulta' : 'Solicitar cita' }}
                </button>
            </div>
        </div>
    </div>
</div>